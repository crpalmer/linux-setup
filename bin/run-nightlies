#!/bin/bash -i

do_nightlies() {
  sync-cm --force-sync
  if [ "$?" != 0 ]; then
    echo "Problems syncing"
    exit 1
  fi

  for nightly in $*
  do
    build-cm $nightly
    release-nightly $nightly
  done

  return 0
}

##########################################################################

(
  # wtf jack server, do you really crash if I don't provide this??
  export USER=crpalmer

  echo "Cleaning /out"
  rm -rf /out/*

  start-cm-14.1
  do_nightlies pme kiwi

  start-cm-13.0
  do_nightlies pme kiwi mondrianlte picassolte

) 2>&1 | tee /tmp/nightlies.txt
