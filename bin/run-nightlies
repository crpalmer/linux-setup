#!/bin/bash -i

UNOFFICIAL="
	device/samsung/mondrianlte
	device/samsung/picassolte
	device/samsung/tabpro-common
	vendor/samsung/tabpro-common
"

changelog-name() {
   echo /tmp/changelog-`echo $1 | sed 's@/@_@g'`.txt
}

generate-changelogs() {
echo $UNOFFICIAL
  for dir in $UNOFFICIAL
  do
echo $dir
changelog-name $dir
    generate-changelog $dir > `changelog-name $dir`
  done
}

push-changelogs() {
  for dir in $UNOFFICIAL
  do
    scp `changelog-name $dir` download.crpalmer.org:/nightlies/
  done
}

##########################################################################

(
  # wtf jack server, do you really crash if I don't provide this??
  export USER=crpalmer

  echo "Cleaning /out"
  rm -rf /out/*

#  start-cm-12.1
#
#  sync-cm --force-sync
#  if [ "$?" != 0 ]; then
#    echo "Problems syncing"
#    exit 1
#  fi
#
#  build-cm kiwi
#  release-nightly kiwi

# ---------------

  start-cm-14.1
  sync-cm --force-sync
  if [ "$?" != 0 ]; then
    echo "Problems syncing"
    exit 1
  fi

  build-cm pme
  release-nightly pme

# ---------------

  start-cm-13.0

  sync-cm --force-sync
  if [ "$?" != 0 ]; then
    echo "Problems syncing"
    exit 1
  fi

  build-cm pme
  release-nightly pme
  build-cm kiwi
  release-nightly kiwi
  build-cm mondrianlte
  release-nightly mondrianlte
  build-cm picassolte
  release-nightly picassolte

) 2>&1 | tee /tmp/nightlies.txt
